<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <title>Checkout - Supermarket App</title>

  <style>
    /* Receipt container */
    .receipt-box {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: auto;
      border: 1px solid #e5e5e5;
    }

    .receipt-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .receipt-header h2 {
      margin: 0;
      font-weight: 700;
    }

    .receipt-table th {
      background: #343a40;
      color: white;
    }

    /* Print only the receipt area */
    @media print {
      body * {
        visibility: hidden;
      }
      #printArea, #printArea * {
        visibility: visible;
      }
      #printArea {
        margin: 0;
        padding: 0;
      }
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>

<body class="bg-light">

  <% if (user && user.role === 'admin') { %>
    <%- include('partials/navbar_admin', { user }) %>
  <% } else { %>
    <%- include('partials/navbar', { user }) %>
  <% } %>
  
  <div class="container mt-5" id="printArea">
    <div class="receipt-box">
      
      <div class="receipt-header">
        <h2>Checkout Summary</h2>
        <p class="text-muted">Thank you for shopping with us!</p>
      </div>

      <% if (cart && cart.length > 0) { %>

      <table class="table table-striped receipt-table">
        <thead>
          <tr>
            <th>Product</th>
            <th width="120">Quantity</th>
            <th width="120">Price</th>
            <th width="140">Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <% cart.forEach(item => { %>
            <tr>
              <td><%= item.productName %></td>
              <td><%= item.quantity %></td>
              <td>$<%= item.price.toFixed(2) %></td>
              <td>$<%= (item.price * item.quantity).toFixed(2) %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <div class="text-end mt-3">
        <h4><strong>Total: $<%= total.toFixed(2) %></strong></h4>
      </div>

      <form action="/checkout" method="POST" class="mt-4">
        <% ids.forEach(id => { %>
          <input type="hidden" name="ids" value="<%= id %>">
        <% }) %>

        <div class="d-flex justify-content-between no-print mt-4">
          <div>
            <button type="button" onclick="window.print()" class="btn btn-outline-secondary">
              üñ®Ô∏è Print Report
            </button>
          </div>

          <div>
            <a href="/cart" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-success">Confirm Checkout ‚úî</button>
          </div>
        </div>
      </form>

      <% } else { %>
        <p>Your cart is empty.</p>
        <a href="/shopping" class="btn btn-primary no-print">Go Shopping</a>
      <% } %>

    </div>
  </div>
  <%- include('partials/footer') %>
</body>
</html>
