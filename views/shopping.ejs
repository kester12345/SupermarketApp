<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Supermarket App</title>

  <style>
    .product-img {
      width: 70px;
      height: 70px;
      object-fit: contain;
    }
    .qty-input {
      width: 80px;
    }
    .table th {
      vertical-align: middle !important;
      font-size: 15px;
    }
    .table td {
      vertical-align: middle !important;
      font-size: 15px;
    }
  </style>

</head>
<body>

  <% if (user && user.role === 'admin') { %>
    <%- include('partials/navbar_admin', { user }) %>
  <% } else { %>
    <%- include('partials/navbar', { user }) %>
  <% } %>

  <div class="container mt-4">

    <p class="mb-3">Welcome, <strong><%= user.username %></strong> (<%= user.role %>)</p>

    <div class="text-center mb-4">
      <h2 class="fw-bold">Products from Supermarket</h2>
    </div>

    <table class="table table-hover table-bordered text-center align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th style="width: 170px;">Product Name</th>
          <th style="width: 140px;">Image</th>
          <th style="width: 80px;">Stock</th>
          <th style="width: 80px;">Price</th>
          <th style="width: 120px;">Quantity</th>
          <th style="width: 150px;">Add to Cart</th>
        </tr>
      </thead>

      <tbody>
        <% products.forEach(product => { %>
          <tr>

            <!-- Product name -->
            <td>
              <a href="/product/<%= product.id %>" class="text-decoration-none fw-semibold">
                <%= product.productName %>
              </a>
            </td>

            <!-- Product image -->
            <td>
              <img src="/images/<%= product.image %>" class="product-img img-thumbnail">
            </td>

            <!-- Stock -->
            <td><%= product.quantity %></td>

            <!-- Price -->
            <td>$<%= product.price.toFixed(2) %></td>

            <!-- Quantity + Add to Cart -->
            <td>
              <form action="/add-to-cart/<%= product.id %>" method="POST" class="d-flex justify-content-center">
                <input 
                  type="number"
                  class="form-control text-center qty-input"
                  name="quantity"
                  value="1"
                  min="1"
                  max="<%= product.quantity %>"
                >
            </td>

            <td>
                <button type="submit" class="btn btn-primary btn-sm px-3">
                  Add to Cart
                </button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

  </div>

  <%- include('partials/footer') %>

</body>
</html>